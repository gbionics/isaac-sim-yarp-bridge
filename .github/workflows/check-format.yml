name: Check Code Formatting

on:
  pull_request:
    branches:
      - main

jobs:
  check-cpp-format:
    name: Check C++ Formatting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install clang-format
        run: |
          sudo apt-get update
          sudo apt-get install -y clang-format

      - name: Check C++ formatting
        run: |
          # Find all C++ files in src and tests directories, excluding autogenerated _ParamsParser files
          files=$(find src tests -type f \( -name "*.cpp" -o -name "*.h" -o -name "*.hpp" \) ! -name "*_ParamsParser.*")

          # Check if any files need formatting
          needs_formatting=0
          for file in $files; do
            if ! clang-format --dry-run --Werror "$file" 2>/dev/null; then
              echo "âŒ File needs formatting: $file"
              needs_formatting=1
            fi
          done

          if [ $needs_formatting -eq 1 ]; then
            echo ""
            echo "Some files are not properly formatted."
            echo "Please run the following command to format your code:"
            echo "  find src tests -type f \( -name \"*.cpp\" -o -name \"*.h\" -o -name \"*.hpp\" \) ! -name \"*_ParamsParser.*\" -exec clang-format -i {} +"
            exit 1
          else
            echo "âœ… All C++ files are properly formatted!"
          fi

  black:

    name: black
    runs-on: ubuntu-latest

    steps:

      - name: "ğŸ”€ Checkout repository"
        uses: actions/checkout@v4

      - name: 'ğŸ Initialize Python'
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: "ğŸ“ Black Code Formatter"
        uses: psf/black@stable
        with:
          src: ./scripts
          jupyter: true
          options: --check --diff

  isort:

    name: isort
    runs-on: ubuntu-latest

    steps:

      - name: "ğŸ”€ Checkout repository"
        uses: actions/checkout@v4

      - name: 'ğŸ Initialize Python'
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: "ğŸ“ isort"
        uses: isort/isort-action@master
        with:
          sortPaths: scripts
          configuration: --profile black --check --diff
